<div class="container">
  <div class="row">
    <div class="col-8">

      <p>ショッピングカート</p>
    </div>
    <div class="col-4 text-right mt-3">
      <%= link_to public_all_destroy_path, method: :delete, "data-confirm" => "本当に空にしますか？" do %>
      <button class= "btn btn-danger">
        カートを空にする
      </button>
      <% end %>
    </div>
    <div class="col-12">


      <table class="table mt-3", border="3">
        <tr>
          <th colspan="2">
            商品名
          </th>
          <th>
            単価(税込)
          </th>
          <th colspan="2">
            数量
          </th>
          <th>
            小計
          </th>
          <th> </th>
        </tr>

        <% @cart_items.each do |cart_item| %>
        <tr>
          <td>
            <%= image_tag cart_item.item.get_profile_image(50,50) %>
          </td>
          <td>
            <%= cart_item.item.name %>
          </td>
          <td>
            <%= cart_item.item.with_tax_price %>
          </td>
          <%= form_with model: cart_item, url: public_cart_item_update_path(cart_item.id),method: :patch do |f| %>
          <td>
            <%= f.select :amount, *[1..100] %>
          </td>
          <td>
            <div class="form_group">
              <%= f.submit "変更", class: "btn btn-success" %>
            </div>
          </td>
          <% end %>
          <td>
            <%= cart_item.subtotal %>
          </td>
          <td>
            <% if cart_item.customer_id == current_customer.id %>
            <%= link_to public_cart_item_destroy_path(cart_item), method: :delete,
            "data-confirm" => "本当に削除しますか？" do %>
            <button class="btn btn-danger btn-sm">
              削除する
            </button>
            <% end %>
            <% end %>
          </td>
          <% @total += (cart_item.subtotal) %>
        </tr>
        <% end %>
      </table>
    </div>
  </div>
  <div class="row">
    <div class="col-4 text-left">
      <%= link_to root_path do %>
      <button class="btn btn-info">
        買い物を続ける
      </button>
      <% end %>
    </div>

    <div class="col-4 text-right">
      <table class="table", border="1">
        <td>
          合計金額
        </td>
        <td>
          <%= @total %>
        </td>
      </table>
    </div>
    <div class="col-12 text-center">
      <%= link_to new_public_order_path do %>
      <button class="btn btn-success">
        情報入力に進む
      </button>
      <% end %>
    </div>
  </div>

</div>